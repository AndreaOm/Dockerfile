FROM ubuntu:14.04


RUN sed -i 's/archive.ubuntu.com/mirrors.ustc.edu.cn/g' /etc/apt/sources.list
ENV TZ=Asia/Shanghai
RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone

# install nodejs
ARG NODE_URL=http://oe58q5lw3.bkt.clouddn.com/n/nodejs/nodejs/node-v4.3.2-linux-x64.tar.gz
RUN apt-get update \
    && apt-get install -y wget unzip \
    && wget -qO /tmp/nodejs.tar.gz $NODE_URL \
    && mkdir -p /opt/node \
    && tar zxf /tmp/nodejs.tar.gz -C /opt/node --strip-components=1 \
    && ln -s /opt/node/bin/node /usr/bin/node \
    && ln -s /opt/node/bin/npm /usr/bin/npm \
    && rm -f /tmp/nodejs.tar.gz \
    && mkdir -p /htdocs

COPY src/CVE_2017_5941.zip /tmp/CVE_2017_5941.zip
RUN set -x \
    && unzip -d /htdocs /tmp/CVE_2017_5941.zip \
    && rm -f /tmp/CVE_2017_5941.zip

EXPOSE 80
WORKDIR /htdocs
CMD ["node", "app.js"]
